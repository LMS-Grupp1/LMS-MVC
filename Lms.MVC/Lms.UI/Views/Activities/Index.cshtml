@using Microsoft.AspNetCore.Identity
@using Lms.MVC.UI.Models.ViewModels
@inject UserManager<ApplicationUser> userManager
@model ListActivityViewModel


@{
    Layout = "ModuleActivityLayout";
}
<head>
    <script src="https://cdn.dhtmlx.com/scheduler/edge/dhtmlxscheduler.js"></script>
    <script src="~/js/dhtmlxscheduler_agenda_view.js"></script>
    <script src="~/js/dhtmlxscheduler_readonly.js"></script>
    <link href="https://cdn.dhtmlx.com/scheduler/edge/dhtmlxscheduler_material.css"
          rel="stylesheet" type="text/css" charset="utf-8">
</head>

@if (User.IsInRole("Student"))
 { 
<div class="sidebar">
    @await Component.InvokeAsync("StudentStatisticsBar", new { CMAType = "module", moduleId = (int)Model.ModuleId })
</div>
 } 


<div class="container">
    <div class="content">

</div>
<h1>@Model.ModuleTitle</h1>
@if (User.IsInRole("Admin") || User.IsInRole("Teacher"))
{
    <p>
        <a asp-action="Create" asp-route-id="@Model.ModuleId" class="btn btn-primary mr-3">Create New Activity</a>
        <a asp-controller="Modules" asp-action="Edit" asp-route-id="@Model.ModuleId" class="btn btn-primary">Edit Module</a>
    </p>
}

<div class="container-fluid">
    <h1>@Model.ModuleTitle</h1>
    @if (User.IsInRole("Admin") || User.IsInRole("Teacher"))
    {
        <p>
            <a asp-action="Create" asp-route-id="@Model.ModuleId" class="btn btn-primary mr-3">Create New Activity</a>
            <a asp-controller="Modules" asp-action="Edit" asp-route-id="@Model.ModuleId" class="btn btn-primary">Edit Module</a>
        </p>
    }
</div>
<div class="container-fluid">
    <div class="row">        
            <div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:100vh;'>
                <div class="dhx_cal_navline">
                    <div class="dhx_cal_prev_button">&nbsp;</div>
                    <div class="dhx_cal_next_button">&nbsp;</div>
                    <div class="dhx_cal_today_button"></div>
                    <div class="dhx_cal_date"></div>
                    <div class="dhx_cal_tab" name="day_tab"></div>
                    <div class="dhx_cal_tab" name="week_tab"></div>
                    <div class="dhx_cal_tab" name="month_tab"></div>
                    <div class="dhx_cal_tab" name="agenda_tab" style="right:280px;"></div>
                </div>
                <div class="dhx_cal_header"></div>
                <div class="dhx_cal_data"></div>
            </div>
    </div>
</div>
    </div>
@section Scripts {
    @*This is the dhtmlx scheduler*@
    <script>
        scheduler.config.readonly_form = true;  
        scheduler.attachEvent("onTemplatesReady", function () {
            scheduler.templates.event_header = function (start, end, ev)
            {               
                return (ev.Title + " " + scheduler.templates.event_date(start) + " - " + scheduler.templates.event_date(end))     
            };
        }); 
        var url = "/Activities/GetEvents/@Html.Raw(Model.ModuleId)";
        var d = new Date();
        scheduler.init('scheduler_here', d.now, "month");
        scheduler.load(url, "json")
    </script>
    
}